# 概覽

[空間架構(SA)概念](#空間架構(SA)概念)  
[CNN層的運算需求](#CNN層的運算需求)  
[CNN的問題考量與解決](#CNN的問題考量與解決)  


# 空間架構(SA)概念

AI有大量的運算，所以透過較佳的資料搬運與儲存策略可以減少大量成本  
解決問題 ： 盡可能降低運算時資料搬運的成本  

空間架構可以以此理解分層，越低層級間的交互就可以越少耗能  
所以設計目標就是盡可能在低層級完成運算與傳輸  


這個系統提供了四個資料存取的儲存階層

| 層級高到低(越低能耗越小)                                                              |                         |
| -------------------------------------------------------------------------- | ----------------------- |
| DRAM                                                                       | 最外圍、最貴                  |
| Global Buffer                                                              | 常用於DRAM資料緩存, 權重、計算中間結果等 |
| 陣列內部（PE 間通訊）                                                       | PE與PE間的資料搬運，空間架構影響了對傳距離 |
| RF（本地暫存） |                         |

關鍵字：  
空間架構(SA)：PE之間可以互傳，所以PE陣列的組成方式很大影響傳輸距離  
數據流(Data flow)：PE與PE間的資料搬運策略  
PE : Processing Engine
通常各個平台有各自的數據流最佳化策略  


# CNN層的運算需求

CNN 每層對於這些運算的實際需求與考量不同  

| 層 | 是否重要           |
| ---- | -------------- |
| CONV | 考量重點           |
| FC   | 考量重點           |
| POOL | 與CONV使用相同的解決方案 |
| ACT  | 可忽略            |

# CNN的問題考量與解決

## 資料處理問題

- 輸入資料存取問題：若直接從 DRAM 為所有 MAC 運算讀取輸入資料，會導致極高的頻寬需求與能耗。  
	- 資料重用（data reuse）方式來緩解  
 		- 卷積重用（convolutional reuse）：CONV層單獨  
   		- 濾波器重用（filter reuse）：CONV, FC層  
     		- ifmap 重用（ifmap reuse）：CONV, FC層  
- 中間資料儲存壓力問題：平行 MAC 運算同時產生大量「部分和」（partial sums, psums），若無法立即進行累加，就需要額外的儲存空間與記憶體 R/W 能量。  
	- 使用 操作排程（operation scheduling）來處理
 	- 無法同時最大化輸入重用與立即累加 psum，因為來自相同濾波器或 ifmap 價值的 psum 無法直接合併。  
  	- 為達成高吞吐量與高能效，CNN 資料流必須同時考慮輸入資料重用與 psum 累加的排程策略  

## 自適應處理

CONV／FC 層可能擁有多種不同的結構 -> 硬體架構不能只支援特定形狀，而應支援動態映射至高效資料流的能力

# CNN 與 ISP 的不同

雖然ISP也有考慮卷積優化，但不能照搬給CNN，因為  

- CNN CONV 是 4D (ISP 是 2D)  
- CNN的Filter 不固定 (訓練計算得來)
- 

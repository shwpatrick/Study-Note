
# 第零章：LangGraph概述(GPT產生，跳過不影響閱讀)


## 什麼是LangGraph?

**LangGraph** 是一個用於構建和管理 **狀態驅動工作流** 的 Python 庫，特別設計來與大型語言模型（LLMs，例如 OpenAI GPT、Google Generative AI）進行互動和協作。它將對話、工具調用和決策邏輯組織為 **有向圖 (DAG)**，便於開發者設計複雜的任務流程。

## LangGraph核心功能

- **狀態管理**  
    LangGraph 的核心是透過狀態管理與語言模型的交互過程，利用 **狀態圖 (StateGraph)** 來記錄和組織多步流程的邏輯。
    
- **工具整合**  
    支援集成工具或外部函數作為處理節點，通過工具調用擴展 LLM 的功能。
    
- **多步工作流 (Multi-Step Workflows)**  
    容易設計多階段工作流，比如問題拆解、翻譯、數據處理、決策分析等任務。
    
- **語言模型驅動**  
    提供內建方式與 LLM 互動，並支持處理結構化輸出（例如 JSON 格式）。
    
- **動態分支**  
    工作流中的節點可以根據輸入或語言模型的輸出動態決定下一步。

## LangGraph關鍵概念

1. **狀態圖 (StateGraph)**  
    將工作流定義為一個有向圖，其中每個節點代表一個處理步驟（例如 LLM 調用、工具調用、邏輯判斷）。
    
2. **節點 (Nodes)**
    
    - **Supervisor Node**：控制整個工作流的流程。
    - **Agent Node**：與 LLM 或工具進行交互的具體步驟。
    - **Tool Node**：執行外部工具的調用。
3. **邊 (Edges)**  
    定義節點之間的流動邏輯，可根據輸出動態選擇下一步。
    
4. **狀態管理 (State Management)**  
    使用類型註解（如 `TypedDict`）管理整個工作流中的狀態，並支持 **增量更新**。


## LangGraph 的設計哲學

LangGraph 鼓勵將 LLM 視為一個狀態驅動的參與者，與傳統的編程邏輯結合，讓人類與 AI 更高效地協作。它通過：

- **結構化設計**：明確每一步的目標和行為。
- **語言模型整合**：簡化與 LLM 的交互過程。
- **可擴展性**：適用於簡單對話機器人到複雜 AI 系統的任務。


## 常見LangGraph 的應用場景

- **多步對話工作流**  
    例如客服問答中多輪對話的處理。
    
- **數據處理與分析**  
    設計 AI 驅動的數據管道，通過多步篩選與處理。
    
- **工具驅動任務執行**  
    整合外部工具（如 API 調用）與 LLM 協作完成任務。
    
- **翻譯與審核工作流**  
    支持多階段的翻譯、審核、分析與排名。


# 第一章：LangGraph 框架理解


## LangGraph 的框架視覺化

![[langGraph flow demo.png]]
langGraph 可以理解成數個邏輯節點與連線組成的框架，每個節點間可以透過判斷條件進行連接，與寫Flow Graph的概念相同。

圖片來源於：Kaggle教程 [Day 3 - Building an agent with LangGraph](https://www.kaggle.com/code/markishere/day-3-building-an-agent-with-langgraph/)


## LLM扮演的角色

LLM Model在框架中扮演的角色是作為節點作業的參與者。

例如：一個翻譯功能的節點，在不使用LLM的作法可能是，呼叫一個函式查詢字典，並且返回字典的翻譯內容，加入LLM後，則會變成，呼叫LLM的API，傳入翻譯文句與格式要求，並且等待接收LLM返回的文字，顯示給使用者。

## 什麼是AI Agent ?

AI Agent 實際上可以理解成LLM的強化功能，我們可以透過LLM來"理解"在節點中要實現的任務目標，並且叫他生成一連串的任務。

例如使用者希望查詢檔案：
LLM 可以理解後並知道要生成呼叫某個函式的一段文字 ：
ex. 
1. 'Serch(file)'
2. 'Sow(fileContext)'

當我們節點中增加了讀取到了這些文字，我們就可以透過判別式執行程式。

這樣的流程讓LLM擁有了使用工具(包括：API、函數)的功能，讓LLM從單純的文字生成器，搖身一變，變成可以真正做事的助理。在一個框架中，可以存在多個AI Agent。


## 為何需要多個Agent ?

讀到這裡可能會有疑惑，一個可以理解決策的LLM為什麼在一個框架中要分開來，變成多個Agent？為甚麼不能讓一個全能的LLM一次分析完？

這個可以從提示工程的概念，從多個方向來解釋，

### 精確度：

LLM是一個通用語言模型，他可以實現多個不同的功能，但往往在準確度上有所欠缺，從提示工程的概念來看，在與LLM溝通前，先說明希望LLM執行或扮演的角色往往可以讓LLM的回覆更貼近要求。

多個Agent可以設定多個人設說明，Agent在各自的目標上更明確。

### 工具使用

LangGraph 有提供一個工具庫的框架，讓全部在流程圖裡的Agent 都可以使用工具庫，以上圖為例，就可以看到有Tools這個節點。

但LLM在有固定人設的時候，不一定能聯想到什麼時候該用其他的工具，有時LLM甚至會唬爛你說這個工具還沒有實作即使你的程式碼就好端端的擺在那裡(慘痛經歷：我曾經叫有點餐機器人人設的LLM幫我使用管理資料夾的函式，它死活不幫我)。而即便你在人設設定裡告訴它這個函式在幹嘛它有時也很難理解。

因此，特定人設的LLM有自己單獨的工具清單是很有必要的。這有助於LLM查找工具。

也可以防止你寫了一個超級壞駭客人設結果拿到你的主機讀寫的控制工具，也許它分分鐘就把你的檔案清光(？

## 易於維護調整

當多個AI Agent功能被分開時，你可以單獨的評估或調整一個節點的執行結果，而不需要「牽一髮而動全身」，在增減以及維護節點上都很有幫助

## 多個AI Agent 的組合框架

對於多個AI Agent的組合框架
可以參考：[Multi-agent Systems](https://langchain-ai.github.io/langgraph/concepts/multi_agent/#multi-agent-architectures)


![[multi Agent struct.png]]

這裡不會多談，我對這部分的研究也還不夠深入。
以下資料可以做為實作參考：
[【Day 16】- Agentic Pattern：以多代理協作模式革新 AI 系統](https://ithelp.ithome.com.tw/articles/10348601)










